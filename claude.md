# ZEGO 바코드 재고 관리 시스템 - Claude 작업 가이드

## 프로젝트 개요

우리곡간식품의 바코드 기반 재고 관리 시스템입니다. 바코드 스캐너를 통해 생산/출고를 기록하고, 실시간으로 재고 현황을 추적합니다.

### 핵심 기능
- 바코드 스캔을 통한 생산/출고 기록
- 실시간 재고 현황 모니터링
- 제품별 바코드 자동 생성
- 바코드 인쇄 (A4 용지, 4열 그리드)
- 목표 재고 설정 및 부족 알림

### 기술 스택
- Frontend: Vanilla JavaScript, HTML, CSS
- Database: Firebase Realtime Database
- Icons: Lucide Icons
- Barcode: JsBarcode 라이브러리

## 프로젝트 구조

```
zego/
├── docs/
│   ├── index.html          # 메인 페이지 (재고 관리 대시보드)
│   ├── barcode-print.html  # 바코드 인쇄 페이지
│   ├── app.js              # 메인 애플리케이션 로직
│   ├── style.css           # 전체 스타일시트
│   └── firebase-config.js  # Firebase 설정
└── claude.md               # 이 파일
```

## 데이터베이스 구조

### Firebase Realtime Database

```javascript
{
  "products": {
    "[제품명]": {
      "name": "제품명",
      "currentStock": 100,      // 현재 재고
      "minStock": 50,           // 목표 재고
      "createdAt": 1234567890,
      "updatedAt": 1234567890
    }
  },
  "barcodes": {
    "[바코드값]": {
      "barcode": "P001-IN-80",  // 형식: P{제품번호}-{타입}-{수량}
      "productName": "제품명",
      "type": "IN" | "OUT" | "VIEW",  // 생산/출고/조회
      "quantity": 80,            // 수량 (VIEW는 0)
      "createdAt": 1234567890
    }
  },
  "history": {
    "[타임스탬프]": {
      "productName": "제품명",
      "type": "IN" | "OUT" | "VIEW",
      "quantity": 80,
      "beforeStock": 100,        // 변경 전 재고
      "afterStock": 180,         // 변경 후 재고
      "timestamp": 1234567890
    }
  }
}
```

## 주요 컴포넌트 및 함수

### 앱 상태 관리 (AppState)
```javascript
const AppState = {
    productsData: {},   // 제품 데이터
    barcodesData: {},   // 바코드 데이터
    historyData: {}     // 히스토리 데이터
}
```

### 핵심 함수들

#### 바코드 스캔 처리
- `handleBarcodeInput()`: 바코드 입력 처리 및 재고 업데이트
- `findBarcodeInfo(barcode)`: 바코드 정보 조회
- `updateStock(barcodeInfo)`: 재고 업데이트 및 히스토리 기록

#### 제품 관리
- `updateProductsTable()`: 재고 현황 테이블 업데이트
- `editProduct(oldProductName)`: 제품명 변경
- `deleteProduct(productName)`: 제품 삭제 (바코드 함께 삭제)

#### 바코드 관리
- `updateBarcodeTable()`: 바코드 관리 테이블 업데이트
- 제품별로 생산/출고 바코드를 그룹화하여 표시

#### 제품 등록
- `productForm.addEventListener('submit')`: 제품 등록 및 바코드 자동 생성
- 생산 수량과 출고 수량을 각각 선택 가능
- 바코드 형식: `P{제품번호}-{타입}-{수량}`

## 코딩 컨벤션 및 규칙

### 1. 바코드 형식
- **생산 바코드**: `P001-IN-80` (제품번호-타입-수량)
- **출고 바코드**: `P001-OUT-40`
- **조회 바코드**: `P001-VIEW` (수량 없음)
- 제품번호는 3자리 (001, 002, ...)

### 2. UI/UX 원칙
- 바코드 스캔이 주요 인터랙션: 페이지 로드 시 자동 포커스
- 스캔 결과는 화면 상단에 5초간 표시
- 재고 현황 섹션은 크고 명확하게 (큰 폰트 사용)
- 모바일 반응형: 테이블을 카드 형태로 변환

### 3. 테이블 레이아웃

#### 재고 현황 테이블
- 제품명 | 현재 재고 | 목표 재고 | 상태
- 목표 재고는 클릭하여 수정 가능

#### 바코드 관리 테이블
- 제품명 | 생산 | 출고 | 작업
- 제품명: 120px (좁게 유지)
- 생산/출고: 수량을 쉼표로 구분하여 나열 (예: 80개, 40개, 10개, 1개)
- 작업: 제품 삭제 버튼만 (trash-2 아이콘)
- **중요**: 수정 버튼은 표시하지 않음 (수정이 필요하면 제품 삭제 후 재등록)

### 4. 제품 등록 프로세스
1. 제품명 입력
2. 생산 수량 단위 선택 (80, 40, 10, 1개 + 커스텀)
3. 출고 수량 단위 선택 (80, 40, 10, 1개 + 커스텀)
4. 제품 등록 버튼 클릭
5. 자동으로 바코드 생성:
   - 선택한 생산 수량별로 IN 타입 바코드 생성
   - 선택한 출고 수량별로 OUT 타입 바코드 생성
   - VIEW 타입 바코드 1개 자동 생성

### 5. 바코드 인쇄
- A4 용지 기준, 4열 그리드 레이아웃
- 각 바코드: 제품명, 타입, 수량, 바코드 이미지
- 인쇄 시 `@media print` 스타일 적용

### 6. 스타일 가이드
- 메인 컬러: 보라색 그라데이션 (#667eea → #764ba2)
- 생산: 녹색 계열 (#10b981, #d1fae5)
- 출고: 오렌지 계열 (#f59e0b, #fed7aa)
- 조회: 블루 계열 (#3730a3, #e0e7ff)
- 경고/삭제: 빨강 계열 (#ef4444)

### 7. 반응형 디자인
- 모바일: 테이블을 카드 형태로 변환
- `@media (max-width: 768px)` 사용
- 재고 현황 섹션은 모바일에서도 큰 폰트 유지

## 주의사항 및 제약사항

### ⚠️ 절대 하지 말아야 할 것
1. **바코드 관리에 수정 버튼 추가 금지**
   - 수정이 필요하면 제품을 삭제하고 새로 등록
   - 각 수량 옆에 수정 아이콘 표시 금지

2. **제품명 컬럼을 너무 넓게 설정 금지**
   - 현재 설정: 120px (max-width)
   - 생산/출고 컬럼이 충분한 공간을 가져야 함

3. **바코드 형식 변경 금지**
   - P{제품번호}-{타입}-{수량} 형식 유지
   - 기존 바코드와의 호환성 중요

4. **Firebase 설정 파일 수정 금지**
   - firebase-config.js는 건드리지 않음

5. **undefined 값 체크 필수**
   - 제품명, 바코드 등 모든 입력값에 대해 'undefined' 문자열 체크
   - `if (value === 'undefined')` 조건 추가

### ✅ 항상 지켜야 할 것
1. **바코드 입력에 항상 포커스**
   - 페이지 로드 시, 섹션 닫을 때 `barcodeInput.focus()` 호출

2. **Lucide 아이콘 재렌더링**
   - 동적으로 HTML을 추가한 후 `lucide.createIcons()` 호출

3. **데이터 필터링**
   - `filterValidProducts()`, `filterValidBarcodes()` 함수로 undefined 제거

4. **에러 처리**
   - try-catch로 Firebase 작업 감싸기
   - 에러 발생 시 사용자에게 명확한 메시지 표시

5. **일관성 유지**
   - 커밋 메시지는 한글로 작성
   - 함수명은 영어, 주석은 한글

## 수정 시 체크리스트

테이블 구조를 변경할 때:
- [ ] HTML 테이블 헤더 (`<th>`) 수정
- [ ] CSS 컬럼 너비 설정 (`nth-child`) 수정
- [ ] JavaScript 렌더링 로직 수정
- [ ] 모바일 반응형 라벨 (`:before { content }`) 수정
- [ ] `colspan` 속성 (no-data 셀) 수정

새로운 기능을 추가할 때:
- [ ] AppState에 필요한 데이터 추가
- [ ] Firebase 리스너 설정
- [ ] UI 업데이트 함수 작성
- [ ] 에러 처리 추가
- [ ] 바코드 입력 포커스 유지 확인

## 자주 발생하는 문제 및 해결책

### 문제: 바코드 스캔이 안 됨
- 해결: `barcodeInput`에 포커스가 있는지 확인
- 다른 모달/섹션을 닫을 때 항상 `barcodeInput.focus()` 호출

### 문제: 아이콘이 표시되지 않음
- 해결: 동적 HTML 추가 후 `lucide.createIcons()` 호출

### 문제: 테이블 컬럼 간격이 맞지 않음
- 해결:
  1. HTML 컬럼 개수 확인
  2. CSS `nth-child` 선택자 개수 확인
  3. 모바일 라벨 개수 확인
  4. `colspan` 속성 확인

### 문제: 제품 삭제 시 바코드가 남아있음
- 해결: `deleteProduct()` 함수에서 관련 바코드도 함께 삭제하는지 확인

## 최근 주요 변경 사항

### 2024년 최신 업데이트
1. 바코드 관리 테이블 간소화
   - 제품별로 한 줄에 생산/출고 모두 표시
   - 수정 버튼 제거 (제품 삭제 후 재등록 방식)
   - 제품명 컬럼 120px로 축소

2. 제품 등록 시스템 개편
   - 생산 수량과 출고 수량을 별도로 선택
   - 체크박스 + 커스텀 입력 방식
   - 조회 바코드 자동 생성

3. 바코드 인쇄 최적화
   - A4 용지에 4열 그리드
   - 바코드 너비 축소하여 더 많이 배치

## Git 작업 규칙

### 커밋 메시지 형식
```
[한글로 작성] 주요 변경 내용

- 세부 항목 1
- 세부 항목 2
- 세부 항목 3

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 푸시 전 확인사항
- [ ] 로컬에서 테스트 완료
- [ ] 콘솔 에러 없음
- [ ] 바코드 스캔 동작 확인
- [ ] 모바일 반응형 확인

---

**마지막 업데이트**: 2024년
**관리자**: 우리곡간식품
**개발 지원**: Claude (Anthropic)
